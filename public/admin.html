<!DOCTYPE html>
<html lang="en">

<head>
  <meta content="width=device-width,initial-scale=1" name="viewport" />

  <title>sb - admin panel</title>
  <meta content="sb - admin panel" property="og:title" />

  <meta content="sb - admin panel" name="description" />
  <meta content="sb - admin panel" property="og:description" />

  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <header>
    <a href="/admin">ADMIN PANEL</a>
    <nav>
      <a href="/">Home</a>
    </nav>
  </header>
  <main>
    <section id="h">
      <div>
        <h1>New Blogpost</h1>
        <br>

        <input id="blogpostTitle" style="max-width: 100%; width: 99%;" type="text" placeholder="Title"/>
        <br>

        <textarea id="blogpostContent" style="max-width:100%; width: 99%; height: 15em;" placeholder="Content"></textarea>
        <br>

        <button type="button" onclick="createBlogpost();">create</button>
      </div>

      {{ range .Blogposts }}
      <div>
        <hr>
        <input id="blogpostTitle{{.ID}}" style="max-width: 100%; width: 99%;" type="text" value="{{.Title}}"/>
        <br>
        <textarea id="blogpostContent{{.ID}}" style="max-width:100%; width: 99%; height: 20em;">{{.Content}}</textarea>
        <br>
        <button type="button" onclick="deleteBlogpost({{.ID}});">delete</button>
        <button type="button" onclick="updateBlogpost({{.ID}});">update</button>
      </div>
      {{ end }}
    </section>
  </main>

  <script type="text/javascript">
    const deleteBlogpost = async (id) => {
        await fetch('/blogposts/delete/' + id, {
            method: 'POST'
        })
        location.reload()
    }
    const updateBlogpost = async (id) => {
        blogpostTitle = document.getElementById("blogpostTitle" + id)
        blogpostContent = document.getElementById("blogpostContent" + id)

        let data = {
            title: blogpostTitle.value,
            content: blogpostContent.value,
        }
        
        await fetch('/blogposts/update/' + id, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        location.reload()
    }

    const createBlogpost = async () => {
        blogpostTitle = document.getElementById("blogpostTitle")
        blogpostContent = document.getElementById("blogpostContent")
        today = new Date()
        var dd = today.getDate();
        var mm = today.getMonth() + 1;
        var yyyy = today.getFullYear();

        let data = {
            title: blogpostTitle.value,
            content: blogpostContent.value,
            date: dd + "/" + mm + "/" + yyyy
        }
        
        await fetch('/blogposts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        location.reload()
    }
  </script>
</body>

</html>
